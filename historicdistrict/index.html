<!DOCTYPE html>

<html lang="en">

    <head>
    
        <meta charset="utf-8">
        
        <title>Building Age and Density in the Greenwich Village Historic District</title>
        
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        <script src="http://d3js.org/queue.v1.min.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <link rel="stylesheet" type="text/css" href="styles.css">
        <link href='http://fonts.googleapis.com/css?family=News+Cycle:400,700' rel='stylesheet' type='text/css'>
<!--         <script src="scripts/modernizr.js"></script> -->
        
    </head>
        
    <body>
    	
    	<div id="selectorcontainer">
		
			<ul>
				
				<li><span>color:</span>
				<a href="Javascript: void(0);" id="y_const" class="notselected">year built</a> / <a href="Javascript: void(0);" id="num_floors" class="selected"># floors</a></li>
				
				<li><span>show:</span>
				<a href="Javascript: void(0);" id="after_hd" class="notselected">built since 1969</a> / <a href="Javascript: void(0);" id="all_b" class="selected">all</a></li>
			
			</ul>
		
		</div>		
		
<script type="text/javascript">

// Width and height
var w = 800 * 1.176470588; // ~816 | makes proportions consistent with shapefile
var h = 800; 

// Tooltip
var div = d3.select("body").append("div")   
            .attr("class", "tooltip")               
            .style("opacity", 0);

// Define map projection
var projection = d3.geo.conicConformal()
                       .rotate([74.0005585, 0])
                       .center([0,40.7344455])
                       .parallels([40.729015, 40.739876])
                       .scale(4600 * w)
                       .translate([w/2, h/2])
                       .precision(.1); 

// Define path generator
var path = d3.geo.path()
                 .projection(projection);

// Create SVG element
var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h); 

// Set variables for current view    		
var color_now = "floors"; // year 
var show_now = "all"; // since   

// 	Define Color ranges			
var color1 = d3.scale.ordinal()
               .domain([1, 2, 3, 4])
               .range(["rgb(26,150,65)", "rgb(166,217,106)", "rgb(253,174,97)", "rgb(215,25,28)"]); 

var colort1 = d3.scale.threshold()
                .domain([1700, 1900, 1940, 1970])
                .range(["rgb(247,247,247)", "#bcbddc", "#9e9ac8", "#756bb1", "#54278f"]);	

var colort2 = d3.scale.threshold()
                .domain([1980, 1990, 2000])
                .range(["#bcbddc", "#9e9ac8", "#756bb1", "#54278f"]);

// Define Legends   
var legend_l1 = ["4 or fewer", "5 - 6", "7 - 9", "10 or more"]
var legend_lt1 = ["N/A", "<1900", "1900-1939", "1940-1969", "1970+"]
var legend_lt2 = ["1970s", "1980s", "1990s", "2000s"]	

d3.json("plutoclip.json", function(error, tp) {
    svg.selectAll(".clippedgeo")
       .data(topojson.feature(tp, tp.objects.clippedgeo).features)
       .enter()
       .append("path")
       .attr("d", path)
       .attr("stroke", "white")
       .attr("stroke-width", 0)
       .attr("fill", function(d) { 
            if (d.properties.HistDist != "Greenwich Village") { return "rgb(247,247,247)"; }
            else { return color1(d.properties.all); }
            })
       
       // Tooltip
       .on("mouseover", function(d) {
            d3.select(this).transition().duration(300).style("opacity", 0.5)
                           .style("stroke-width", 3 ) 
                           .style("color", "#000000");
            })
       .on("click", function(d) {
            d3.select(this).transition().duration(300).style("opacity", 0.5)
                           .style("stroke-width", 3 );
            div.transition().duration(300)
                .style("opacity", 1)
            div.html(
                     "<b>" + d.properties.Address + "</b>" + "<br>" + 
                     "<img src='" + 
                     "http://maps.googleapis.com/maps/api/streetview?size=150x150&location=?" + 
                     encodeURIComponent(d.properties.Address) + 
                     "%NYC&sensor=false&key=AIzaSyBoxwmXxAi2VdzMXqyrvEtgcqNh2r4hm0Q" + 
                     "'>" +
                     "<b>Year Built: </b>" + d.properties.YearBuilt + "<br>" + 
                     "<b>Number of Floors: </b>" + d.properties.NumFloors + "<br>" + 
                     "<b>Building Sq. Ft.: </b>" + d.properties.BldgArea + "<br>" + 
                     "<b># Residential Units: </b>" + d.properties.UnitsRes + "<br>" + 
                     "<b>Zoning: </b>" + d.properties.AllZoning1 + "<br>" 
//                      "Block: " + d.properties.Block + " | " + "Lot: " + d.properties.Lot + "<br>"  
                     )
                .style("left", (d3.event.pageX + 20) + "px")
                .style("top", (d3.event.pageY + 20) + "px");
            })
       .on("mouseout", function() {
            d3.select(this)
                .transition().duration(300)
                .style("opacity", 1)
                .style("stroke-width", 0 )
                ;
            div.transition().duration(300)
                .style("opacity", 0);
            })
        // End Tooltip
            
    }) // End d3.json

// street names

var sndata = [
{nm: "SEVENTH AVENUE", rot: 66, lon: -74.00190, lat: 40.735111},
{nm: "HUDSON STREET", rot: 84, lon: -74.006083, lat: 40.735144},
{nm: "FIFTH AVENUE", rot: 62, lon: -73.996141, lat: 40.732248},
{nm: "14TH STREET", rot: 333, lon: -73.995178, lat: 40.736642},
{nm: "BARROW STREET", rot: 353, lon: -74.007828, lat: 40.731651},
{nm: "SIXTH AVENUE", rot: 61, lon: -73.999288, lat: 40.733893}
];

var stnames = svg.selectAll("g.stnames")
                 .data(sndata)
                 .enter()
                 .append("g")
                 .attr("class", "stnames"); 
            
       stnames.append("text")
              .attr("x", function(d, i) { return ((-74.008927 - d.lon) / -0.016737) * w ; })
              .attr("y", function(d, i) { return (1-((40.729015 - d.lat) / -0.010861)) * h ; })
              .text(function(d, i) { return d.nm; })
              .attr("transform", function(d, i) { return "rotate(" + -d.rot + " " + ((-74.008927 - d.lon) / -0.016737) * w + "," + (1-((40.729015 - d.lat) / -0.010861)) * h + ")"; })
              .style("font-size", "10"); 
//         FIXES: use scales instead of manual transformations; move style to CSS

    // Legend


    
// var legend = svg.selectAll("g.legend")    
    
    // End Legend

</script>
				        
    </body>
    
</html>
